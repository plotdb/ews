!function(){function e(n,t){var e,r={}.hasOwnProperty;for(e in t)r.call(t,e)&&(n[e]=t[e]);return n}ews.sdbClient=function(n){var t=this;return e(this,{_evthdr:{},_connection:null,_ws:(n=null==n?{}:n).ws}),this._ws.addEventListener("close",function(){return t._connection=null,t._sws=null,t.fire("close")}),this},ews.sdbClient.prototype=e(Object.create(Object.prototype),{on:function(n,e){var r=this;return(Array.isArray(n)?n:[n]).map(function(n){var t;return((t=r._evthdr)[n]||(t[n]=[])).push(e)})},fire:function(n){for(var t,e,r,o,s=[],i=[],c=1,u=arguments.length;c<u;++c)i.push(arguments[c]);for(t=i,c=0,r=(e=this._evthdr[n]||[]).length;c<r;++c)o=e[c],s.push(o.apply(this,t));return s},getSnapshot:function(n){var t=this,o=n.id,s=n.version,i=n.collection;return new Promise(function(e,r){return t._connection.fetchSnapshot(null!=i?i:"doc",o,null!=s?s:null,function(n,t){return n?r(n):e(t)})})},get:function(n){var o=this,s=n.id,i=n.watch,c=n.create,u=n.collection;return(this._connection?Promise.resolve():this.connect()).then(function(){return new Promise(function(e,t){var r=o._connection.get(null!=u?u:"doc",s);return r.fetch(function(n){return n?t(n):(r.subscribe(function(n,t){return e(r)}),r.on("error",function(n){return o.fire("error",{doc:r,err:n})}),null!=i&&r.on("op",function(n,t){return i(n,t)}),r.type?void 0:r.create((c?c():null)||{}))})})})},connect:function(){var n=this;return this._connection?Promise.resolve():(2!==this._ws.status()&&this._ws.connect(),Promise.resolve().then(function(){return n._sws=new ews({ws:n._ws,scope:"sharedb"}),n._connection=new sharedb.Connection(n._sws)}))},disconnect:function(){return this._ws.disconnect()},cancel:function(){return this._ws.cancel()},status:function(){return this._ws.status()},ensure:function(){return this._ws.ensure()}}),"undefined"!=typeof module&&null!==module?module.exports=ews.sdbClient:"undefined"!=typeof window&&null!==window&&(window.ews.sdbClient=ews.sdbClient)}.call(this);
