!function(){function t(n,e){var t,r={}.hasOwnProperty;for(t in e)r.call(e,t)&&(n[t]=e[t]);return n}ews.sdbClient=function(n){var e=this;return t(this,{_evthdr:{},_connection:null,_ws:(n=null==n?{}:n).ws}),this._ws.addEventListener("offline",function(){if(e._connection&&e._sws)return e._connection=null,e._sws=null,e.fire("close")}),this._ws.addEventListener("close",function(){if(e._connection&&e._sws)return e._connection=null,e._sws=null,e.fire("close")}),this},ews.sdbClient.prototype=t(Object.create(Object.prototype),{on:function(n,t){var r=this;return(Array.isArray(n)?n:[n]).map(function(n){var e;return((e=r._evthdr)[n]||(e[n]=[])).push(t)})},fire:function(n){for(var e,t,r,o,s=[],i=[],c=1,u=arguments.length;c<u;++c)i.push(arguments[c]);for(e=i,c=0,r=(t=this._evthdr[n]||[]).length;c<r;++c)o=t[c],s.push(o.apply(this,e));return s},getSnapshot:function(n){var e=this,o=n.id,s=n.version,i=n.collection;return new Promise(function(t,r){return e._connection.fetchSnapshot(null!=i?i:"doc",o,null!=s?s:null,function(n,e){return n?r(n):t(e)})})},get:function(n){var o=this,s=n.id,i=n.watch,c=n.create,u=n.collection;return(this._connection?Promise.resolve():this.connect()).then(function(){return new Promise(function(t,e){var r=o._connection.get(null!=u?u:"doc",s);return r.fetch(function(n){return n?e(n):(r.subscribe(function(n,e){return t(r)}),r.on("error",function(n){return o.fire("error",{doc:r,err:n})}),null!=i&&r.on("op",function(n,e){return i(n,e)}),r.type?void 0:r.create((c?c():null)||{}))})}).catch(function(n){return"wrapped-lderror"===n.code&&(n=t(new Error,JSON.parse(n.message))),Promise.reject(n)})})},connect:function(){var n=this;return this._connection?Promise.resolve():(2!==this._ws.status()&&this._ws.connect(),Promise.resolve().then(function(){return n._sws=new ews({ws:n._ws,scope:"sharedb"}),n._connection=new sharedb.Connection(n._sws)}))},disconnect:function(){return this._ws.disconnect()},cancel:function(){return this._ws.cancel()},status:function(){return this._ws.status()},ensure:function(){return this._ws.ensure()}}),"undefined"!=typeof module&&null!==module?module.exports=ews.sdbClient:"undefined"!=typeof window&&null!==window&&(window.ews.sdbClient=ews.sdbClient)}.call(this);
